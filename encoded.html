<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kryptos | Encoded</title>
    <style>
        body {
            margin: 0;
            font-family: 'Courier New', Courier, monospace;
            background-color: #ffffff;
            padding: 1rem;
        }

        .zoom {
            padding: 0 0 1rem 0;
        }

        .zoom input {
            width: 300px;
        }

        .kryptos {
            display: flex;
            min-height: 100%;
            transform-origin: top left;
        }

        .kryptos__cipher,
        .kryptos__vigenere {
            flex: 1;
        }

        table {
            border-collapse: collapse;
            cursor: default;
            table-layout: fixed;
            min-width: max-content;
        }

        table td {
            width: 24px;
            height: 24px;
            border: 1px dashed rgba(49, 65, 122, .5);
            text-align: center;
            color: #212529;
        }

        table tr td:first-child,
        table tr:first-child {
            background-color: #edeff8;
            font-weight: bold;
        }

        table tr:not(:first-child) td.hover:not(:first-child):hover {
            background-color: rgba(0, 0, 0, 0.8) !important;
            color: #ffffff !important;
        }

        table td.cross {
            background-color: rgba(0, 0, 0, 0.4) !important;
        }

        /* Color alphabetical row top */
        #vigenere tr:nth-child(2) {
            background-color: #edeff8;
            font-weight: bold;
        }

        /* Color alphabetical row bottom */
        #vigenere tr:last-child {
            background-color: #edeff8;
            font-weight: bold;
        }
        
        /* Color alphabetical column left */
        #vigenere tr:nth-child(n+3):nth-child(-n+28) td:nth-child(n+2):nth-child(-n+2) {
            background-color: #edeff8;
            color: #212529;
            font-weight: bold;
        }

        /* Color rebeated alphabetical columns right */
        #vigenere tr:nth-child(n+2) td:nth-last-child(n+1):nth-last-child(-n+4) {
            background-color: #edeff8;
            color: #212529;
            font-weight: bold;
        }

        /* Adjust for L */
        #vigenere tr:nth-child(16) td:nth-last-child(n+5):nth-last-child(-n+5) {
            background-color: #edeff8;
            color: #212529;
            font-weight: bold;
        }

        /* Adjust for L */
        #vigenere tr:nth-child(16) td:nth-last-child(n+0):nth-last-child(-n+1) {
            background-color: #edeff8;
            color: #212529;
        } 
        
        .k1 { background-color: #fd9694; }
        .k2 { background-color: #5dd0c4; }
        .k3 { background-color: #ffe598; }
        .k4 { background-color: #8db5f9; }
    </style>
</head>
<body>
    <div class="zoom">
        <input type="range" id="zoom" name="zoom" min="0" max="200" value="100" />
    </div>
    <div class="kryptos" id="kryptos">
        <div class="kryptos__cipher">
            <table id="cipher"></table>
        </div>
        <div class="kryptos__vigenere">
            <table id="vigenere"></table>
        </div>
    </div>
</body>
    <script>
        // -------------------------------------------------------------------------------
        // Helpers
        // -------------------------------------------------------------------------------
        const makeGrid = (grid, table, callback = undefined) => {
            let longest = 0;
            grid.forEach((line, index) => {
                const row = document.createElement('tr');
                const side = document.createElement('td');
                side.innerHTML = padZero(index);
                row.appendChild(side);

                line.split('').forEach((letter, position) => {
                    const cell = document.createElement('td');
                    cell.innerHTML = letter;
                    row.appendChild(cell);

                    callback && callback(cell, index, position);
                });
                table.appendChild(row);

                if(line.length > longest) {
                    longest = line.length;
                }
            });
            
            makeTopRow(table, longest);
        }

        const makeTopRow = (table, longest) => {
            const topRow = document.createElement('tr');
            for(let i = 0; i < longest; i++) {
                if(i === 0) {
                    const cell = document.createElement('td');
                    cell.innerHTML = '';
                    topRow.appendChild(cell);
                }

                const cell = document.createElement('td');
                cell.innerHTML = padZero(i);
                topRow.appendChild(cell);
            }
            table.prepend(topRow);
        }

        const padZero = (i) => {
            return i < 10 ? '0' + i : i;
        }

        const applyKColors = (cell, index, position) => {
            if(index <= 1) {
                cell.classList.add('k1')
            }

            if(index >= 2 && index <= 13) {
                cell.classList.add('k2')
            }

            if(index >= 14 && index <= 24 && (!(index === 24 && position > 26))) {
                cell.classList.add('k3');
            }

            if(index >= 24 && index <= 27) {
                if(index === 24 && position > 26) {
                    cell.classList.add('k4');
                }

                if(index >= 25) {
                    cell.classList.add('k4');
                }
            }
        }

        const applyCrossColor = (table, row, col) => {
            table.rows[row].querySelectorAll('td').forEach(cell => {
                cell.classList.add('cross');
            });

            Array.from(table.rows).forEach(row => {
                const cell = row.cells[col];
                if(cell) {
                    cell.classList.add('cross');
                }
            });
        }

        const removeCrossColor = (table) => {
            table.querySelectorAll('td.cross').forEach(cell => {
                cell.classList.remove('cross');
            });
        }

        const attachCellHover = (table) => {
            table.addEventListener('mouseover', (e) => {
                const td = e.target.closest('td');
                if(!td || !table.contains(td)) {
                    return
                }

                const tr = td.parentElement;
                const row = tr.rowIndex;
                const col = td.cellIndex;

                if((table.id === 'cipher' && row > 0 && col > 0) || (table.id === 'vigenere' && row >= 2 && row <= 27 && col >= 2 && col <= 27)) {
                    td.classList.add('hover');
                    applyCrossColor(table, row, col);
                }
            });

            table.addEventListener('mouseout', (e) => {
                const td = e.target.closest('td');
                if(!td || !table.contains(td)) {
                    return
                }

                td.classList.remove('hover');
                removeCrossColor(table);
            });
        }

        // -------------------------------------------------------------------------------
        // Left side: Cipher
        // -------------------------------------------------------------------------------
        (() => {
            const table = document.getElementById('cipher');
            const grid = [
                'EMUFPHZLRFAXYUSDJKZLDKRNSHGNFIVJ',
                'YQTQUXQBQVYUVLLTREVJYQTMKYRDMFD',
                'VFPJUDEEHZWETZYVGWHKKQETGFQJNCE',
                'GGWHKK?DQMCPFQZDQMMIAGPFXHQRLG',
                'TIMVMZJANQLVKQEDAGDVFRPJUNGEUNA',
                'QZGZLECGYUXUEENJTBJLBQCRTBJDFHRR',
                'YIZETKZEMVDUFKSJHKFWHKUWQLSZFTI',
                'HHDDDUVH?DWKBFUFPWNTDFIYCUQZERE',
                'EVLDKFEZMOQQJLTTUGSYQPFEUNLAVIDX',
                'FLGGTEZ?FKZBSFDQVGOGIPUFXHHDRKF',
                'FHQNTGPUAECNUVPDJMQCLQUMUNEDFQ',
                'ELZZVRRGKFFVOEEXBDMVPNFQXEZLGRE',
                'DNQFMPNZGLFLPMRJQYALMGNUVPDXVKP',
                'DQUMEBEDMHDAFMJGZNUPLGEWJLLAETG',
                'ENDYAHROHNLSRHEOCPTEOIBIDYSHNAIA',
                'CHTNREYULDSLLSLLNOHSNOSMRWXMNE',
                'TPRNGATIHNRARPESLNNELEBLPIIACAE',
                'WMTWNDITEENRAHCTENEUDRETNHAEOE',
                'TFOLSEDTIWENHAEIOYTEYQHEENCTAYCR',
                'EIFTBRSPAMHHEWENATAMATEGYEERLB',
                'TEEFOASFIOTUETUAEOTOARMAEERTNRTI',
                'BSEDDNIAAHTTMSTEWPIEROAGRIEWFEB',
                'AECTDDHILCEIHSITEGOEAOSDDRYDLORIT',
                'RKLMLEHAGTDHARDPNEOHMGFMFEUHE',
                'ECDMRIPFEIMEHNLSSTTRTVDOHW?OBKR',
                'UOXOGHULBSOLIFBBWFLRVQQPRNGKSSO',
                'TWTQSJQSSEKZZWATJKLUDIAWINFBNYP',
                'VTTMZFPKWGDKZXTJCDIGKUHUAUEKCAR'
            ];

            makeGrid(grid, table, (cell, index, position) => {
                applyKColors(cell, index, position);
            });
            attachCellHover(table);
        })();

        // -------------------------------------------------------------------------------
        // Right side: Vigenere
        // -------------------------------------------------------------------------------
        (() => {
            const table = document.getElementById('vigenere');
            const grid = [
                ' ABCDEFGHIJKLMNOPQRSTUVWXYZABCD',
                'AKRYPTOSABCDEFGHIJLMNQUVWXZKRYP',
                'BRYPTOSABCDEFGHIJLMNQUVWXZKRYPT',
                'CYPTOSABCDEFGHIJLMNQUVWXZKRYPTO',
                'DPTOSABCDEFGHIJLMNQUVWXZKRYPTOS',
                'ETOSABCDEFGHIJLMNQUVWXZKRYPTOSA',
                'FOSABCDEFGHIJLMNQUVWXZKRYPTOSAB',
                'GSABCDEFGHIJLMNQUVWXZKRYPTOSABC',
                'HABCDEFGHIJLMNQUVWXZKRYPTOSABCD',
                'IBCDEFGHIJLMNQUVWXZKRYPTOSABCDE',
                'JCDEFGHIJLMNQUVWXZKRYPTOSABCDEF',
                'KDEFGHIJLMNQUVWXZKRYPTOSABCDEFG',
                'LEFGHIJLMNQUVWXZKRYPTOSABCDEFGH',
                'MFGHIJLMNQUVWXZKRYPTOSABCDEFGHI',
                'NGHIJLMNQUVWXZKRYPTOSABCDEFGHIJL',
                'OHIJLMNQUVWXZKRYPTOSABCDEFGHIJL',
                'PIJLMNQUVWXZKRYPTOSABCDEFGHIJLM',
                'QJLMNQUVWXZKRYPTOSABCDEFGHIJLMN',
                'RLMNQUVWXZKRYPTOSABCDEFGHIJLMNQ',
                'SMNQUVWXZKRYPTOSABCDEFGHIJLMNQU',
                'TNQUVWXZKRYPTOSABCDEFGHIJLMNQUV',
                'UQUVWXZKRYPTOSABCDEFGHIJLMNQUVW',
                'VUVWXZKRYPTOSABCDEFGHIJLMNQUVWX',
                'WVWXZKRYPTOSABCDEFGHIJLMNQUVWXZ',
                'XWXZKRYPTOSABCDEFGHIJLMNQUVWXZK',
                'YXZKRYPTOSABCDEFGHIJLMNQUVWXZKR',
                'ZZKRYPTOSABCDEFGHIJLMNQUVWXZKRY',
                ' ABCDEFGHIJKLMNOPQRSTUVWXYZABCD'
            ];

            makeGrid(grid, table);
            attachCellHover(table);
        })();

        // -------------------------------------------------------------------------------
        // Zoom Control
        // -------------------------------------------------------------------------------
        (() => {
            const slider = document.getElementById('zoom');
            const kryptos = document.getElementById('kryptos');

            slider.addEventListener('input', (event) => {
                const zoom = event.target.value;
                kryptos.style.scale = zoom / 100;
            });
        })();
    </script>
</html>